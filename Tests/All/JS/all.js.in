var global = global || this;
if (typeof @LIBRARY_NAME@ === "object" && @LIBRARY_NAME@) {
	(function () {
		var doc = global.document,
			commonElements,
			tests,

			runTests,

			testIndex,
			tester;

		commonElements = (function () {
			var key = "getElementById",
				obj = {};
			obj.node_test = doc[key]("node_test");
			obj.create_test = doc[key]("create_test");
			obj.classes_test = doc[key]("classes_test");
			obj.traverse_test = doc[key]("traverse_test");
			obj.test_form = doc[key]("test_form");
			obj.start = doc[key]("start");
			obj.stop = doc[key]("stop");
			obj.results = doc[key]("results");
			return obj;
		}());

		doc = null;

		function prepend(node)
		{
			var par = commonElements.node_test;
			if (par && node) {
				node =  @LIBRARY_NAME@.node.prepend(
					par,
					node,
					par.lastChild
				);
			}
			return node;
		}

		function makeElement(
			doc,
			tag
		)
		{
			var result = null;
			if (@LIBRARY_NAME@.create.element) {
				result = @LIBRARY_NAME@.create.element(
					doc,
					tag
				);
			}
			return result;
		}

		function insertBefore()
		{
			var node;
			if (@LIBRARY_NAME@.create.element) {
				node = makeElement(
					global.document,
					"li"
				);
			}
			if (node) {
				node = prepend(node);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				node
			);
		}

		function generateList(
			num
		)
		{
			var index = num - 1,
				node,
				list = [];
			while (index > -1) {
				node = makeElement(
					global.document,
					"li"
				);
				if (node) {
					list[index] = node;
				}
				index -= 1;
			}
			return list;
		}

		function generatePrependList()
		{
			return generateList(3);
		}

		function insertList()
		{
			var list = generatePrependList(),
				par = commonElements.node_test,
				nodes;
			if (par && list && list.length) {
				nodes = @LIBRARY_NAME@.node.prependList(
					par,
					list,
					par.lastChild
				);
			}
			return @LIBRARY_NAME@.is.type(
				nodes,
				"undefined"
			);
		}

		function appendChild()
		{
			var node = makeElement(
				global.document,
				"li"
			);
			node = @LIBRARY_NAME@.node.append(
				commonElements.node_test,
				node
			);
			return @LIBRARY_NAME@.is.nodeLike(
				node
			);
		}

		function generateAppendList()
		{
			return generateList(3);
		}

		function appendList()
		{
			var list = generateAppendList(),
				nodes,
				par = commonElements.node_test;
			if (list && list.length) {
				nodes = @LIBRARY_NAME@.node.appendList(
					par,
					list
				);
			}
			return @LIBRARY_NAME@.is.type(
				nodes,
				"undefined"
			);
		}

		function removeChild()
		{
			var par = commonElements.node_test,
				node;
			if (par) {
				node = @LIBRARY_NAME@.node.remove(
					par,
					par.lastChild
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				node
			);
		}

		function replace(node)
		{
			var par = commonElements.node_test;
			if (par) {
				node =  @LIBRARY_NAME@.node.replace(
					par,
					node,
					par.lastChild
				);
			}
			return node;
		}

		function makeText(
			doc,
			text
		)
		{
			var result = null;
			if (@LIBRARY_NAME@.create.text) {
				result = @LIBRARY_NAME@.create.text(
					doc,
					text
				);
			}
			return result;
		}

		function replaceChild()
		{
			var node = makeText(
				global.document,
				"c = b^x; x = log(c) / log(b)"
			);
			if (node) {
				node = replace(node);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				node
			);
		}

		function cloneNode()
		{
			var node = @LIBRARY_NAME@.node.clone(
				commonElements.node_test,
				true
			);
			return @LIBRARY_NAME@.is.nodeLike(
				node
			);
		}

		function createElement()
		{
			var test = makeElement(
				global.document,
				"p"
			);
			return @LIBRARY_NAME@.is.element(
				test
			);
		}

		function createTextNode()
		{
			var test = makeText(
				global.document,
				"The rain in Spain is quite plain."
			);
			return @LIBRARY_NAME@.is.text(
				test
			);
		}

		function makeComment(
			doc,
			text
		)
		{
			var result = null;
			if (@LIBRARY_NAME@.create.comment) {
				result = @LIBRARY_NAME@.create.comment(
					doc,
					text
				);
			}
			return result;
		}

		function createComment()
		{
			var test = makeComment(
				global.document,
				"No comment."
			);
			return @LIBRARY_NAME@.is.comment(
				test
			);
		}

		function makeDocumentFragment(
			doc
		)
		{
			var result = null;
			if (@LIBRARY_NAME@.create.documentFragment) {
				result = @LIBRARY_NAME@.create.documentFragment(
					doc
				);
			}
			return result;
		}

		function createDocumentFragment()
		{
			var test = makeDocumentFragment(
				global.document
			);
			return @LIBRARY_NAME@.is.documentFragment(
				test
			);
		}

		function contains()
		{
			var test,
				node = commonElements.classes_test;
			if (@LIBRARY_NAME@.classes.contains) {
				test = @LIBRARY_NAME@.classes.contains(
					node,
					"good"
				);
			}
			return @LIBRARY_NAME@.is.type(
				test,
				"boolean"
			);
		}

		function containsList()
		{
			var node = commonElements.classes_test,
				tokens  = @LIBRARY_NAME@.classes.containsList(
					node,
					["a", "b", "c"]
				);
			return @LIBRARY_NAME@.is.type(
				tokens,
				"boolean"
			);
		}

		function add()
		{
			var test,
				node = commonElements.classes_test;
			if (@LIBRARY_NAME@.classes.add) {
				test = @LIBRARY_NAME@.classes.add(
					node,
					"good"
				);
			}
			return @LIBRARY_NAME@.is.type(
				test,
				"undefined"
			);
		}

		function addList()
		{
			var node = commonElements.classes_test,
				test = @LIBRARY_NAME@.classes.addList(
					node,
					["a", "b", "c"]
				);
			return @LIBRARY_NAME@.is.type(
				test,
				"undefined"
			);
		}

		function remove()
		{
			var node = commonElements.classes_test,
				test = null;
			if (@LIBRARY_NAME@.classes.remove) {
				test = @LIBRARY_NAME@.classes.remove(
					node,
					"good"
				);
			}
			return @LIBRARY_NAME@.is.type(
				test,
				"undefined"
			);
		}

		function removeList()
		{
			var node = commonElements.classes_test,
				tokens = @LIBRARY_NAME@.classes.removeList(
					node,
					["a", "b", "c"]
				);
			return @LIBRARY_NAME@.is.type(
				tokens,
				"undefined"
			);
		}

		function toggle()
		{
			var node = commonElements.classes_test,
				test = null;
			if (@LIBRARY_NAME@.classes.toggle) {
				test = @LIBRARY_NAME@.classes.toggle(
					node,
					"toggle"
				);
			}
			return @LIBRARY_NAME@.is.type(
				test,
				"boolean"
			);
		}

		function toggleList()
		{
			var node = commonElements.classes_test,
				test = @LIBRARY_NAME@.classes.toggleList(
					node,
					["a", "b", "c"]
				);
			return @LIBRARY_NAME@.is.type(
				test,
				"undefined"
			);
		}

		function get()
		{
			var node = commonElements.classes_test,
				test;
			if (@LIBRARY_NAME@.classes.get) {
				test = @LIBRARY_NAME@.classes.get(
					node
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function childNodes()
		{
			var node = commonElements.traverse_test,
				nodes = @LIBRARY_NAME@.traverse.getNodes(
					node
				);
			return @LIBRARY_NAME@.is.arrayLike(
				nodes
			);
		}

		function optimisticFilter(node)
		{
			return true;
		}

		function childNodesTraversed()
		{
			var node = commonElements.traverse_test,
				nodes = @LIBRARY_NAME@.traverse.nodes(
					node,
					optimisticFilter
				);
			return @LIBRARY_NAME@.is.arrayLike(
				nodes
			);
		}

		function children()
		{
			var node = commonElements.traverse_test,
				test;
			if (@LIBRARY_NAME@.traverse.getElements) {
				test = @LIBRARY_NAME@.traverse.getElements(
					node
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function pessimisticFilter(node)
		{
			return false;
		}

		function childrenTraversed()
		{
			var node = commonElements.traverse_test,
				nodes = @LIBRARY_NAME@.traverse.elements(
					node,
					pessimisticFilter
				);
			return @LIBRARY_NAME@.is.arrayLike(
				nodes
			);
		}

		function tree()
		{
			var nodes = @LIBRARY_NAME@.traverse.getNodeTree(
				global.document
			);
			return @LIBRARY_NAME@.is.arrayLike(
				nodes
			);
		}

		function treeTraversed()
		{
			var nodes = @LIBRARY_NAME@.traverse.nodeTree(
				global.document,
				optimisticFilter
			);
			return @LIBRARY_NAME@.is.arrayLike(
				nodes
			);
		}

		function getText()
		{
			var node = commonElements.traverse_test,
				text = @LIBRARY_NAME@.traverse.getText(
					node
				);
			return @LIBRARY_NAME@.is.type(
				text,
				"string"
			);
		}

		function setText()
		{
			var node = commonElements.traverse_test,
				text = @LIBRARY_NAME@.traverse.setText(
					"NEW TEXTUAL CONTENT",
					node,
					global.document
				);
			return @LIBRARY_NAME@.is.type(
				text,
				"string"
			);
		}

		function childrenTree()
		{
			var tree = @LIBRARY_NAME@.traverse.getElementTree(
				global.document
			);
			return @LIBRARY_NAME@.is.arrayLike(
				tree
			);
		}

		function childrenTreeTraversed()
		{
			var nodes = @LIBRARY_NAME@.traverse.elementTree(
				global.document,
				optimisticFilter
			);
			return @LIBRARY_NAME@.is.arrayLike(
				nodes
			);
		}

		function isAncestor()
		{
			var child = commonElements.traverse_text,
				node = @LIBRARY_NAME@.traverse.isAncestor(
					global.document,
					child
				);
			return @LIBRARY_NAME@.is.type(
				node,
				"boolean"
			);
		}

		function ancestors()
		{
			var node = commonElements.traverse_test,
				list = @LIBRARY_NAME@.traverse.getAncestors(
					node
				),
				test;
			if (list && list.value) {
				test = list.value;
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function ancestorsTraversed()
		{
			var node = commonElements.traverse_test,
				nodes = @LIBRARY_NAME@.traverse.ancestors(
					node,
					optimisticFilter
				);
			return @LIBRARY_NAME@.is.arrayLike(
				nodes
			);
		}

		function byName()
		{
			var test;
			if (@LIBRARY_NAME@.select.byName) {
				test = @LIBRARY_NAME@.select.byName(
					global.document,
					"control1"
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function byTagName()
		{
			var test;
			if (@LIBRARY_NAME@.select.byTagName) {
				test = @LIBRARY_NAME@.select.byTagName(
					global.document,
					"input"
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function byClassName()
		{
			var test;
			if (@LIBRARY_NAME@.select.byClassName) {
				test = @LIBRARY_NAME@.select.byClassName(
					global.document,
					"container"
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function byId()
		{
			var test;
			if (@LIBRARY_NAME@.select.byId) {
				test = @LIBRARY_NAME@.select.byId(
					global.document,
					"select_test"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function query()
		{
			var test;
			if (@LIBRARY_NAME@.select.query) {
				test = @LIBRARY_NAME@.select.query(
					global.document,
					"input[type=text]"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function queryAll()
		{
			var test;
			if (@LIBRARY_NAME@.select.queryAll) {
				test = @LIBRARY_NAME@.select.queryAll(
					global.document,
					"input[type]"
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function head()
		{
			var test;
			if (@LIBRARY_NAME@.select.head) {
				test = @LIBRARY_NAME@.select.head(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function body()
		{
			var test;
			if (@LIBRARY_NAME@.select.body) {
				test = @LIBRARY_NAME@.select.body(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function images()
		{
			var test;
			if (@LIBRARY_NAME@.select.images) {
				test = @LIBRARY_NAME@.select.images(
					global.document,
					"0"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function allImages()
		{
			var test;
			if (@LIBRARY_NAME@.select.allImages) {
				test = @LIBRARY_NAME@.select.allImages(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function embeds()
		{
			var test;
			if (@LIBRARY_NAME@.select.embeds) {
				test = @LIBRARY_NAME@.select.embeds(
					global.document,
					"0"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function allEmbeds()
		{
			var test;
			if (@LIBRARY_NAME@.select.allEmbeds) {
				test = @LIBRARY_NAME@.select.allEmbeds(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function plugins()
		{
			var test;
			if (@LIBRARY_NAME@.select.plugins) {
				test = @LIBRARY_NAME@.select.plugins(
					global.document,
					"0"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function allPlugins()
		{
			var test;
			if (@LIBRARY_NAME@.select.allPlugins) {
				test = @LIBRARY_NAME@.select.allPlugins(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function links()
		{
			var test;
			if (@LIBRARY_NAME@.select.links) {
				test = @LIBRARY_NAME@.select.links(
					global.document,
					"0"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function allLinks()
		{
			var test;
			if (@LIBRARY_NAME@.select.allLinks) {
				test = @LIBRARY_NAME@.select.allLinks(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function forms()
		{
			var test;
			if (@LIBRARY_NAME@.select.forms) {
				test = @LIBRARY_NAME@.select.forms(
					global.document,
					"0"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function allForms()
		{
			var test;
			if (@LIBRARY_NAME@.select.allForms) {
				test = @LIBRARY_NAME@.select.allForms(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function scripts()
		{
			var test;
			if (@LIBRARY_NAME@.select.scripts) {
				test = @LIBRARY_NAME@.select.scripts(
					global.document,
					"0"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function allScripts()
		{
			var test;
			if (@LIBRARY_NAME@.select.allScripts) {
				test = @LIBRARY_NAME@.select.allScripts(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function applets()
		{
			var test;
			if (@LIBRARY_NAME@.select.applets) {
				test = @LIBRARY_NAME@.select.applets(
					global.document,
					"0"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function allApplets()
		{
			var test;
			if (@LIBRARY_NAME@.select.allApplets) {
				test = @LIBRARY_NAME@.select.allApplets(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function anchors()
		{
			var test;
			if (@LIBRARY_NAME@.select.anchors) {
				test = @LIBRARY_NAME@.select.anchors(
					global.document,
					"0"
				);
			}
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function allAnchors()
		{
			var test;
			if (@LIBRARY_NAME@.select.allAnchors) {
				test = @LIBRARY_NAME@.select.allAnchors(
					global.document
				);
			}
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		function namedItem()
		{
			var node = commonElements.test_form,
				test = @LIBRARY_NAME@.select.namedItem(
					node,
					"elements",
					"control1"
				);
			return @LIBRARY_NAME@.is.nodeLike(
				test
			);
		}

		function collection()
		{
			var node = commonElements.test_form,
				test = @LIBRARY_NAME@.select.collection(
				node,
				"elements"
			);
			return @LIBRARY_NAME@.is.arrayLike(
				test
			);
		}

		tests = [
			insertBefore,
			insertList,
			appendChild,
			appendList,
			removeChild,
			replaceChild,
			cloneNode,
			createElement,
			createTextNode,
			createComment,
			createDocumentFragment,
			contains,
			containsList,
			add,
			addList,
			remove,
			removeList,
			toggle,
			toggle,
			toggleList,
			get,
			childNodes,
			childNodesTraversed,
			children,
			childrenTraversed,
			tree,
			treeTraversed,
			getText,
			setText,
			childrenTree,
			childrenTreeTraversed,
			isAncestor,
			ancestors,
			ancestorsTraversed,
			byName,
			byTagName,
			byClassName,
			byId,
			query,
			queryAll,
			head,
			body,
			images,
			allImages,
			embeds,
			allEmbeds,
			plugins,
			allPlugins,
			links,
			allLinks,
			forms,
			allForms,
			scripts,
			allScripts,
			applets,
			allApplets,
			anchors,
			allAnchors,
			namedItem,
			collection
		];

		function createMessage(text)
		{
			var str = String(text);
			if (str === "") {
				str = "[an empty string]";
			}
			return @LIBRARY_NAME@.create.text(
				global.document,
				str
			);
		}

		function grabById(
			id
		)
		{
			return global.document.getElementById(
				id
			);
		}

		function addMessage(
			msg,
			num
		)
		{
			var cell = grabById("result_" + num),
				row = grabById("test_" + num),
				text = createMessage(msg);
			if (cell) {
				@LIBRARY_NAME@.node.append(
					cell,
					text
				);
			}
			if (row) {
				if (msg === "true") {
					row.className = "pass";
				} else if (msg === "false") {
					row.className = "fail";
				} else if (msg === "ERROR") {
					row.className = "error";
				}
			}
		}

		function runTest(
			test,
			key
		)
		{
			var result = null;
			if (typeof test === "function") {
				try {
					result = test();
					result = String(result);
				} catch (e) {
					result = "ERROR";
				}
				addMessage(result, key);
			}
		}

		runTests = (function () {
			var max = tests.length;
			return function () {
				if (testIndex < max) {
					runTest(
						tests[testIndex],
						testIndex + 1
					);
					testIndex += 1;
					tester = global.setTimeout(
						runTests,
						100
					);
				} else if (testIndex >= max) {
					testIndex = 0;
				}
			};
		}());

		function startTests(
			evt
		)
		{
			testIndex = 0;
			runTests();
			this.disabled = true;
			this.onclick = function () {};
		}

		function clearResult(
			num
		)
		{
			var cell = grabById("result_" + num),
				row = grabById("test_" + num),
				index;
			if (cell && row) {
				index = cell.childNodes.length - 1;
				for (index; index > -1; index -= 1) {
					cell.removeChild(
						cell.childNodes[index]
					);
				}
				row.className = "";
			}
		}

		function clearTests()
		{
			var index = 0,
				max = tests.length;
			for (index; index < max; index += 1) {
				clearResult(index + 1);
			}
		}

		function endTests(evt)
		{
			global.clearTimeout(tester);
			tester = null;
			clearTests();
			commonElements.start.disabled = false;
			commonElements.start.onclick = startTests;
		}

		function addHandlers()
		{
			commonElements.start.onclick = startTests;
			commonElements.stop.onclick = endTests;
		}

		addHandlers();
	}());
}
